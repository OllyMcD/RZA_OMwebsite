@page "/login"
@using RZA_OMwebsite.Services
@inject AuthService AuthService
@inject CustomerService CustomerService
@inject NavigationManager Navigation

<br /> 
<br />

<MudPaper Class="pa-4 mx-auto" MaxWidth="400px" Elevation="2">
    <MudText Typo="Typo.h4" Align="Align.Center">Login</MudText>

    <MudForm>
        <MudTextField Label="Username" @bind-Value="username" Required="true" Class="mb-3" />
        <MudTextField Label="Password" @bind-Value="password" InputType="InputType.Password" Required="true" Class="mb-3" />
        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="LoginUser" Class="mt-3" FullWidth="true">Login</MudButton>
    </MudForm>

    @if (showError)
    {
        <MudAlert Severity="Severity.Error" Variant="Variant.Outlined" Square="true" Class="my-2">Login failed. Please check your credentials.</MudAlert>
    }
</MudPaper>

@code {
    private string? username;
    private string? password;
    private bool showError;

    private async Task LoginUser()
    {
        // Check if username or password is null or empty
        if (string.IsNullOrWhiteSpace(username) || string.IsNullOrWhiteSpace(password))
        {
            showError = true; // Show error message for empty fields
            return;
        }

        // Now you can safely access the instance method ValidateLoginAsync
        bool isValidUser = await CustomerService.ValidateLoginAsync(username, password);

        if (isValidUser)
        {
            AuthService.Login(); // Set the login status
            Navigation.NavigateTo("/main"); // Redirect to Main Page
        }
        else
        {
            showError = true; // Show error message
        }
    }
}
