@page "/visitor-info"
@using RZA_OMwebsite.Services
@using RZA_OMwebsite.Pages
@using MudBlazor
@inject AuthService AuthService
@inject PageService PageService
@inject NavigationManager NavigationManager

<MudContainer MaxWidth="MaxWidth.ExtraExtraLarge" Style="background-color: #F3CA5F; padding: 2rem;">
    <MudPaper Class="pa-4 mx-auto" MaxWidth="600px" Elevation="3">
        <MudText Typo="Typo.h4" Align="Align.Center">Visitor Information</MudText>
        <MudDivider Class="my-2" />

        @if (!AuthService.isLoggedIn)
        {
            <MudText Typo="Typo.body1" Align="Align.Center" Color="Color.Error">You must be logged in to access this page.</MudText>
            <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="@(() => NavigationManager.NavigateTo("/"))">Go to Home</MudButton>
        }
        else
        {
            <MudText Typo="Typo.body1" Align="Align.Center">Welcome to our Visitor Info page! Here’s what you need to know:</MudText>
            <MudText Typo="Typo.body2" Class="mt-2">
                🌟 **Hours of Operation:** We're open daily from 9 AM to 5 PM.
            </MudText>
            <MudText Typo="Typo.body2" Class="mt-2">
                🗺️ **Location:** 123 Zoo Lane, Animal City.
            </MudText>
            <MudText Typo="Typo.body2" Class="mt-2">
                🎟️ **Tickets:** Purchase your tickets online or at the gate. Discounts available for groups!
            </MudText>
            <MudText Typo="Typo.body2" Class="mt-2">
                🍽️ **Food & Drink:** Enjoy a variety of dining options throughout the park.
            </MudText>
        }
    </MudPaper>
</MudContainer>

@code {
    private bool first = true;

    protected override async Task OnInitializedAsync()
    {
        if (!CheckLoginStatus())
        {
            NavigationManager.NavigateTo("/"); // Redirect to home if not logged in
        }
    }

    private bool CheckLoginStatus()
    {
        return AuthService.isLoggedIn; // Check the login status
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // Get the current page URL (this can be adjusted depending on how you're tracking page URL)
            var currentPageUrl = NavigationManager.Uri.Substring(22);

            // Call the method to track the page view
            await PageService.TrackPageViewAsync(currentPageUrl);
            first = false;
        }
    }
}
